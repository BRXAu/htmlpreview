<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Prolog Line Break Demo</title>
  <script src="https://cdn.jsdelivr.net/npm/tau-prolog@0.3.2/modules/core.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/tau-prolog@0.3.2/modules/lists.js"></script>
  <style>
    body { font-family: Arial, sans-serif; padding: 20px; }
    textarea { width: 100%; height: 150px; }
    #output { margin-top: 20px; white-space: pre-wrap; }
  </style>
</head>
<body>
<h2>Prolog Line Break Tool</h2>
<textarea id="userText"></textarea><br>
<label>Container width (characters):</label>
<input type="number" id="containerWidth" value="40">
<button onclick="processText()">Insert Line Breaks</button>

<div id="output"></div>

<script>
let session = pl.create();
session.consult(":- use_module(library(lists))."); // Load lists module

function processText() {
  const text = document.getElementById("userText").value.trim();
  const containerWidth = parseInt(document.getElementById("containerWidth").value);

  // Prepare Prolog list of [Word, Length] atoms
  const words = text.split(/\s+/);
  const wordsList = `[${words.map(w => `['${w}', ${w.length}]`).join(',')}]`;

  const program = `
    insert_breaks([], _, []).
    insert_breaks([ [W,L] | Ws ], Width, Result) :-
      insert_breaks_acc([ [W,L] | Ws ], Width, 0, [], Result).

    insert_breaks_acc([], _, _, Acc, Acc).
    insert_breaks_acc([ [W,L] | Ws ], Width, CurrentLen, Acc, Result) :-
      NewLen is CurrentLen + L + 1,
      (NewLen > Width ->
         append(Acc, ['\\n', W], NewAcc),
         insert_breaks_acc(Ws, Width, L, NewAcc, Result)
      ;
         append(Acc, [W], NewAcc),
         insert_breaks_acc(Ws, Width, NewLen, NewAcc, Result)
      ).

  `;

  session.consult(program, {
    success: () => {
      session.query(`insert_breaks(${wordsList}, ${containerWidth}, Result).`, {
        success: () => {
          session.answers(ans => {
            if(ans !== false) {
              // Convert Tau Prolog list to JS array
              const resultList = ans.lookup("Result").toJavaScript();
              const textOutput = resultList.join(' ').replace(/ \n /g, '\n');
              document.getElementById("output").textContent = textOutput;

              return false; // STOP after first solution, prevents overwriting with "No result."
            }
          });
        },
        error: e => console.error("Query error:", e)
      });
    },
    error: e => console.error("Consult error:", e)
  });
}
</script>
</body>
</html>
