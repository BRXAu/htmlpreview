<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>SVG animator — live controls</title>
  <style>
    :root {
      font-family: system-ui, -apple-system, "Segoe UI", Roboto, "Helvetica Neue", Arial;
      --ui-gap: 10px;
      --panel-bg: #f5f6f7;
      --panel-border: #e1e4e8;
      --control-width: 120px;
      --accent: #0a66c2;
    }

    body {
      margin: 24px;
      color: #111;
      background: #fff;
      -webkit-font-smoothing:antialiased;
    }

    h1 {
      margin: 0 0 12px 0;
      font-size: 18px;
      font-weight: 600;
    }

    .layout {
      display: grid;
      grid-template-columns: 1fr 360px;
      gap: 24px;
      align-items: start;
    }

    .canvas {
      background: white;
      padding: 16px;
      border: 1px solid var(--panel-border);
      border-radius: 8px;
      box-shadow: 0 6px 18px rgba(10,10,10,0.04);
    }

    .controls {
      background: var(--panel-bg);
      padding: 14px;
      border: 1px solid var(--panel-border);
      border-radius: 8px;
      display: flex;
      flex-direction: column;
      gap: 12px;
    }

    .control-row {
      display:flex;
      gap:8px;
      align-items:center;
    }

    label {
      min-width: 140px;
      font-size: 13px;
    }

    input[type="text"], input[type="number"] {
      width: var(--control-width);
      padding: 6px 8px;
      border-radius: 6px;
      border: 1px solid var(--panel-border);
      font-size: 13px;
    }

    .small {
      width: 120px;
    }

    .btn {
      display:inline-flex;
      align-items:center;
      justify-content:center;
      gap:8px;
      padding:8px 12px;
      border-radius:6px;
      border:1px solid rgba(0,0,0,0.08);
      background:white;
      cursor:pointer;
      font-weight:600;
      font-size:13px;
    }

    .btn:active { transform: translateY(1px); }

    .btn-primary {
      background: linear-gradient(180deg, var(--accent), #0a58a8);
      color: white;
      border: none;
    }

    .theme-buttons {
      display:flex;
      gap:8px;
      flex-wrap:wrap;
    }

    .theme-btn {
      width:48px;
      height:32px;
      border-radius:6px;
      border:1px solid var(--panel-border);
      cursor:pointer;
    }

    .theme-yellow { background: #F7941D; }
    .theme-black { background: #000; }
    .theme-gray { background: #CCCCCC; }
    .theme-white { background: #fff; box-shadow: inset 0 0 0 1px rgba(0,0,0,0.06); }

    pre {
      margin:0;
      padding:8px;
      background:#fff;
      border-radius:6px;
      border:1px solid var(--panel-border);
      font-size:12px;
      overflow:auto;
    }

    .row {
      display:flex;
      gap:8px;
      align-items:center;
    }

    .footer {
      font-size:13px;
      color:#444;
      margin-top:8px;
    }

    /* Make the inline SVG responsive-ish */
    .svg-wrap {
      width: 100%;
      max-width: 780px;
      overflow: visible;
    }

    /* small helper */
    .muted { color:#666; font-size:13px; }

    /* Visualiser styles */
    .bezier-wrap {
      display:flex;
      gap:8px;
      align-items:center;
    }
    #bezierCanvas {
      border-radius:6px;
      background: #fff;
      border: 1px solid var(--panel-border);
      cursor: crosshair;
    }
    .bezier-coords {
      font-size:12px;
    }

    .AIBox {
      display: flex;
      flex-direction: column;
      font-weight: bold;
      gap: 10px;
    }

/*    start svg styles*/
:root {
  /* colour css variables*/
  --color-yellow: #F7941D;
  --color-black: #000000;
  --color-white: #FFFFFF;
  --color-gray: #CCCCCC;

  /*  Animation css variables*/
  --text-01-duration: 1.1s;
  --text-01-start: 0.7s;
  --text-01-step: 0.0s;
  --text-01-offset-distance: translateX(416px);

  --text-02-duration: 1.2s;
  --text-02-start: 1.15s;
  --text-02-step: 0.0s;
  --text-02-offset-distance: translateX(-380px);

  /* --text-easing: cubic-bezier(0, 0.65, 0.5, 1); */

  --text-easing: cubic-bezier(0, 1, 1, 1);

  --divider-start: 0.2s;
  --divider-duration: 0.7s;
  --divider-ease: cubic-bezier(0.68, 1.1, 0.32, 1.15);

  --divider-transform-start: skewX(26deg) translateX(30px) scale(0);
  --divider-transform-end:   skewX(0deg)  translateX(0px) scale(1);

  --mask-start: 0.2;
  --mask-duration: 0.4s;
  --mask-easing: linear;
}

/* Define color themes */

.yellow {
  --text-color: var(--color-yellow);
}

.black {
  --text-color: var(--color-black);
}

.gray {
  --text-color: var(--color-gray);
}

.white {
  --text-color: var(--color-white);
}

/* Zieger text */

.text_01_characters {
  fill: var(--text-color);
  transform: var(--text-01-offset-distance);
  animation: moveText01 var(--text-01-duration) forwards var(--text-easing);
}

/* Bailey text */
.text_02_characters {
  fill: var(--text-color);
  transform: var(--text-02-offset-distance);
  animation: moveText02 var(--text-02-duration) forwards var(--text-easing);
}

/* Auto-stagger text_01 by order */
#text_01_inner > .text_01_characters {
  animation-delay: calc(var(--text-01-start) + var(--text-01-step) * (var(--n, 0)));
}

/* Auto-stagger text_01 by order */
#text_02_inner > .text_02_characters {
  animation-delay: calc(var(--text-02-start) + var(--text-02-step) * (var(--n, 0)));
}

#text_01_01 { --n: 0; }
#text_01_02 { --n: 1; }
#text_01_03 { --n: 2; }
#text_01_04 { --n: 3; }
#text_01_05 { --n: 4; }
#text_01_06 { --n: 5; }
#text_01_07 { --n: 6; }

/* Reverse-order stagger for text_02 */
#text_02_01 { --n: 5; }
#text_02_02 { --n: 4; }
#text_02_03 { --n: 3; }
#text_02_04 { --n: 2; }
#text_02_05 { --n: 1; }
#text_02_06 { --n: 0; }

/* Divider */
#divider {
  transform-origin: center;
}

.dividerPath {
  fill: var(--text-color);
}

#clipPath_divider_01_A {
  transform-origin: center;
  transform: scaleY(0);
  animation: maskIn var(--mask-duration) forwards var(--mask-easing);
  animation-delay: var(--mask-start);
}

/* Keyframe */
@keyframes moveText01 { to { transform: translateX(0); } }
@keyframes moveText02 { to { transform: translateX(0); } }
@keyframes maskIn { to { transform: scaleY(1); } }
  </style>
</head>
<body>
  <h1>SVG animator — live controls</h1>

  <div class="layout">
    <div class="canvas" id="canvas">
      <div class="svg-wrap" id="svgContainer">
        <!-- Inline SVG (unchanged from your source) -->
        <svg id="logoSvg" width="762" height="62" viewBox="0 0 761 61" fill="none" xmlns="http://www.w3.org/2000/svg">
<style>


</style>

<defs>
  <!-- Clip path for Ziegler text start -->
  <clipPath id="clipPath_text_02_A">
    <!-- <rect width="366" height="62" fill="white"/> -->
    <path d="M393 62.0001L811 62L811 -7.62939e-06L425 2.61158e-05L393 62.0001Z" fill="white"/>
  </clipPath>
  <!-- Clip path for Ziegler text end -->
  <!-- Clip path for Bailey text start -->
  <clipPath id="clipPath_text_01_A">
    <!-- <rect width="318" height="60" fill="white" x="444" y="1"/> -->
    <path d="M418 3.05176e-05H0V62H386L418 3.05176e-05Z" fill="white"/>
  </clipPath>
  <clipPath id="clipPath_divider_01_A">
    <rect width="36" height="62" fill="white" x="386"/>
  </clipPath>
  <!-- Clip path for Bailey text end -->
</defs>

<!-- Logo container start -->
<g class="yellow" id="logo_container">

  <!-- Ziegler Text start -->
  <g id="text_01" clip-path="url(#clipPath_text_01_A)">
    <g id="text_01_inner">
      <path class="text_01_characters" id="text_01_01" d="M1.16692 3.54744V10.1989V17.6205L7.63167 10.1989H28.4496L0 51.0412V59.0463H41.5891V52.3015V49.8509V46.7002H33.1406V49.8509H12.9528L41.5891 9.03197V1.02689H1.16692V3.54744Z"/>
      <path class="text_01_characters" id="text_01_02" d="M70.3421 35.2177H92.5836V25.859H70.3421V10.1989H95.781V1.02689H60.1665V59.0463H96.6212V49.8509H70.3421V35.2177Z"/>
      <path class="text_01_characters" id="text_01_03" d="M125.911 1.02689H115.642V59.0229H125.911V1.02689Z"/>
      <path class="text_01_characters" id="text_01_04" d="M173.895 37.7383H190.488C190.488 45.2299 182.577 50.7845 173.988 50.7845C162.879 50.7845 154.617 41.1924 154.617 30.1533C154.617 19.1142 162.949 9.52209 173.801 9.52209C179.029 9.52209 183.744 11.7159 187.198 15.17L194.596 8.6819C189.555 3.38408 182.133 0 173.801 0C157.208 0 144.255 13.6297 144.255 30.1299C144.255 46.6302 157.044 60.0265 174.152 60.0265C190.325 60.0265 201.691 50.271 201.691 29.1264H173.918V37.7149L173.895 37.7383Z"/>
      <path class="text_01_characters" id="text_01_05" d="M229.277 1.02689H219.008V59.0463H251.845V49.8509H229.277V1.02689Z"/>
      <path class="text_01_characters" id="text_01_06" d="M277.611 35.2177H299.852V25.859H277.611V10.1989H303.05V1.02689H267.435V59.0463H303.89V49.8509H277.611V35.2177Z"/>
      <path class="text_01_characters" id="text_01_07" d="M349.657 37.5749C358.502 36.3846 363.963 27.9828 363.963 19.651C363.963 10.3856 358.502 1.05023 345.526 1.05023H322.794V59.0463H333.063V37.925H338.291L352.597 59.0463H364.71L349.633 37.5749H349.657ZM333.063 29.2431V10.1989H344.756C350.403 10.1989 353.671 14.4932 353.671 19.791C353.671 25.0888 350.637 29.2197 343.402 29.2197H333.04L333.063 29.2431Z"/>
    </g>
  </g>
  <!-- Ziegler Text end -->

  <!-- Bailey Text start -->
  <g id="text_02" clip-path="url(#clipPath_text_02_A)">
    <g id="text_02_inner">
      <path class="text_02_characters" id="text_02_01" d="M484.6 28.0528C490.504 25.9524 492.185 20.4678 492.185 15.9402C492.185 7.09489 485.79 1.05023 475.684 1.05023H444.201L453.116 8.82194V50.5978H448.425V59.0463H477.458C489.501 59.0463 495.312 50.7144 495.312 42.546C495.312 36.1513 491.694 29.4998 484.623 28.0762L484.6 28.0528ZM463.385 10.1989H475.264C479.722 10.1989 481.916 13.3029 481.916 17.3638C481.916 21.4247 479.558 24.4354 475.264 24.4354H463.385V10.1989ZM475.848 49.8509H463.385V33.0939H476.104C482.242 33.0939 484.95 37.3882 484.95 41.5191C484.95 45.9067 481.846 49.8509 475.848 49.8509Z"/>
      <path class="text_02_characters" id="text_02_02" d="M527.752 1.02689L505.954 59.0229H516.9L521.871 44.7865H544.673L549.714 59.0229H560.566L538.861 1.02689H527.752ZM524.975 35.8945L533.307 12.3227L541.569 35.8945H524.975Z"/>
      <path class="text_02_characters" id="text_02_03" d="M585.562 1.02689H575.293V59.0229H585.562V1.02689Z"/>
      <path class="text_02_characters" id="text_02_04" d="M617.769 1.02689H607.477V59.0463H640.314V49.8509H617.769V1.02689Z"/>
      <path class="text_02_characters" id="text_02_05" d="M666.103 35.2177H688.321V25.859H666.103V10.1989H691.518V1.02689H655.904V59.0463H692.358V49.8509H666.103V35.2177Z"/>
      <path class="text_02_characters" id="text_02_06" d="M748.044 1.02689L732.641 23.5952L717.401 1.02689H705.288L727.506 32.6038V59.0463H737.868V32.6972L760.25 1.02689H748.044Z"/>
    </g>
  </g>
  <!-- Bailey Text end -->

  <!-- Divider start -->
  <g id="divider" clip-path="url(#clipPath_divider_01_A)">
    <path class='dividerPath' d="M388.188 53.5151L410.663 7.30493H421.212L398.737 53.5151H388.188Z"/>
  </g>

  <!-- Divider end -->

</g>
<!-- Logo container end -->

</svg>
      </div>
    </div>

    <aside class="controls" aria-label="Controls">
      <div>
        <div class="row" style="justify-content:space-between;align-items:center">
          <strong>Animation variables</strong>
          <div style="display:flex;gap:8px">
            <button class="btn" id="resetDefaults">Reset defaults</button>
            <button class="btn btn-primary" id="applyAll">Apply</button>
          </div>
        </div>

        <div class="AIBox">
          <div style="margin-top:4px; font-size: 24px" >Ask AI to do it</div>
          <div style="margin-top:0px; font-size: 11px" class="muted">Require llama3 to be running locally</div>

        <textarea id="aiPrompt" rows="4" style="width:100%"></textarea>
        <button class="btn btn-primary" id="runAi">Send prompt</button>
      </div>

        <div style="margin-top:18px" class="muted"><b>Or you can Edit the values.</b><br>Units like "s" and "px" accepted for offsets.</div>
      </div>

      <div style="display:grid;gap:6px;margin-top:8px">
        <div class="control-row">
          <label for="t1-duration">Text 01 duration</label>
          <input id="t1-duration" type="text" value="1.1s" />
        </div>
        <div class="control-row">
          <label for="t1-start">Text 01 start</label>
          <input id="t1-start" type="text" value="0.7s" />
        </div>
        <div class="control-row">
          <label for="t1-step">Text 01 step</label>
          <input id="t1-step" type="text" value="0.0s" />
        </div>
        <div class="control-row">
          <label for="t1-offset">Text 01 offset</label>
          <input id="t1-offset" type="text" value="translateX(416px)" />
        </div>

        <hr style="border:none;border-top:1px solid var(--panel-border);margin:6px 0">

        <div class="control-row">
          <label for="t2-duration">Text 02 duration</label>
          <input id="t2-duration" type="text" value="1.2s" />
        </div>
        <div class="control-row">
          <label for="t2-start">Text 02 start</label>
          <input id="t2-start" type="text" value="1.15s" />
        </div>
        <div class="control-row">
          <label for="t2-step">Text 02 step</label>
          <input id="t2-step" type="text" value="0.0s" />
        </div>
        <div class="control-row">
          <label for="t2-offset">Text 02 offset</label>
          <input id="t2-offset" type="text" value="translateX(-380px)" />
        </div>

        <hr style="border:none;border-top:1px solid var(--panel-border);margin:6px 0">

        <div class="control-row">
          <label for="easing">Text easing</label>
          <input id="easing" type="text" value="cubic-bezier(0, 1, 1, 1)" />
        </div>

        <!-- Bezier visualiser -->
        <div class="bezier-wrap" style="margin-top:6px;">
          <canvas id="bezierCanvas" width="220" height="120"></canvas>
          <div class="bezier-coords">
            <div>Control 1: <span id="c1">0.000, 1.000</span></div>
            <div>Control 2: <span id="c2">1.000, 1.000</span></div>
            <div style="margin-top:8px">
              <button class="btn" id="applyVisual">Apply easing</button>
            </div>
          </div>
        </div>

        <div style="display:flex;gap:8px;align-items:center;margin-top:8px">
          <button class="btn" id="restartBtn">Refresh animations</button>
          <button class="btn" id="downloadBtn">Copy inline SVG</button>
        </div>
      </div>

      <div style="margin-top:12px">
        <strong>Themes</strong>
        <div class="theme-buttons" style="margin-top:8px">
          <button class="theme-btn theme-yellow" title="Yellow" data-theme="yellow"></button>
          <button class="theme-btn theme-black" title="Black" data-theme="black"></button>
          <button class="theme-btn theme-gray" title="Gray" data-theme="gray"></button>
          <button class="theme-btn theme-white" title="White" data-theme="white" style="border:1px solid #ccc"></button>
        </div>
        <div class="footer">Click a swatch to change the text colour class inside the SVG.</div>
      </div>

      <div style="margin-top:12px">
        <strong>Live CSS variables (current)</strong>
        <pre id="liveVars" aria-live="polite"></pre>
      </div>


    </aside>
  </div>

  <script>
    (function () {
      const svgContainer = document.getElementById('svgContainer');
      const svgEl = () => document.getElementById('logoSvg');
      const applyBtn = document.getElementById('applyAll');
      const restartBtn = document.getElementById('restartBtn');
      const downloadBtn = document.getElementById('downloadBtn');
      const resetBtn = document.getElementById('resetDefaults');
      const liveVarsPre = document.getElementById('liveVars');

      // inputs
      const t1Duration = document.getElementById('t1-duration');
      const t1Start = document.getElementById('t1-start');
      const t1Step = document.getElementById('t1-step');
      const t1Offset = document.getElementById('t1-offset');

      const t2Duration = document.getElementById('t2-duration');
      const t2Start = document.getElementById('t2-start');
      const t2Step = document.getElementById('t2-step');
      const t2Offset = document.getElementById('t2-offset');

      const easingInput = document.getElementById('easing');

      const themeButtons = document.querySelectorAll('[data-theme]');

      let styles = `--text-01-duration: 1.1s\n--text-01-start: 0.7s\n--text-01-step: 0.0s\n--text-01-offset-distance: translateX(416px)\n--text-02-duration: 1.2s\n--text-02-start: 1.15s\n--text-02-step: 0.0s\n--text-02-offset-distance: translateX(-380px)\n--text-easing: cubic-bezier(0, 1, 1, 1)`

      // default map
      const defaults = {
        '--text-01-duration': '1.1s',
        '--text-01-start': '0.7s',
        '--text-01-step': '0.0s',
        '--text-01-offset-distance': 'translateX(416px)',
        '--text-02-duration': '1.2s',
        '--text-02-start': '1.15s',
        '--text-02-step': '0.0s',
        '--text-02-offset-distance': 'translateX(-380px)',
        '--text-easing': 'cubic-bezier(0, 1, 1, 1)'
      };

      function setVarOnSvg(name, value) {
        const s = svgEl();
        if (!s) return;
        s.style.setProperty(name, value);
      }

      function applyAll() {
        setVarOnSvg('--text-01-duration', t1Duration.value || defaults['--text-01-duration']);
        setVarOnSvg('--text-01-start', t1Start.value || defaults['--text-01-start']);
        setVarOnSvg('--text-01-step', t1Step.value || defaults['--text-01-step']);
        setVarOnSvg('--text-01-offset-distance', t1Offset.value || defaults['--text-01-offset-distance']);

        setVarOnSvg('--text-02-duration', t2Duration.value || defaults['--text-02-duration']);
        setVarOnSvg('--text-02-start', t2Start.value || defaults['--text-02-start']);
        setVarOnSvg('--text-02-step', t2Step.value || defaults['--text-02-step']);
        setVarOnSvg('--text-02-offset-distance', t2Offset.value || defaults['--text-02-offset-distance']);

        setVarOnSvg('--text-easing', easingInput.value || defaults['--text-easing']);

        updateLiveVars();
      }

      function updateLiveVars() {
        const s = svgEl();
        if (!s) { liveVarsPre.textContent = '(svg not found)'; return; }
        const cs = window.getComputedStyle(s);
        const out = [
          `--text-01-duration: ${cs.getPropertyValue('--text-01-duration') || ''}`,
          `--text-01-start: ${cs.getPropertyValue('--text-01-start') || ''}`,
          `--text-01-step: ${cs.getPropertyValue('--text-01-step') || ''}`,
          `--text-01-offset-distance: ${cs.getPropertyValue('--text-01-offset-distance') || ''}`,
          `--text-02-duration: ${cs.getPropertyValue('--text-02-duration') || ''}`,
          `--text-02-start: ${cs.getPropertyValue('--text-02-start') || ''}`,
          `--text-02-step: ${cs.getPropertyValue('--text-02-step') || ''}`,
          `--text-02-offset-distance: ${cs.getPropertyValue('--text-02-offset-distance') || ''}`,
          `--text-easing: ${cs.getPropertyValue('--text-easing') || ''}`
        ];
        liveVarsPre.textContent = out.join('\\n');
      }

      function restartAnimations() {
        const s = svgEl();
        if (!s) return;
        const clone = s.cloneNode(true);
        // preserve inline variable overrides
        for (let i = 0; i < s.style.length; i++) {
          const prop = s.style[i];
          clone.style.setProperty(prop, s.style.getPropertyValue(prop));
        }
        s.parentNode.replaceChild(clone, s);
        setTimeout(updateLiveVars, 40);
      }

      function resetDefaults() {
        t1Duration.value = defaults['--text-01-duration'];
        t1Start.value = defaults['--text-01-start'];
        t1Step.value = defaults['--text-01-step'];
        t1Offset.value = defaults['--text-01-offset-distance'];

        t2Duration.value = defaults['--text-02-duration'];
        t2Start.value = defaults['--text-02-start'];
        t2Step.value = defaults['--text-02-step'];
        t2Offset.value = defaults['--text-02-offset-distance'];

        easingInput.value = defaults['--text-easing'];

        const s = svgEl();
        if (s) s.style.cssText = '';

        updateLiveVars();
      }

      function setTheme(themeName) {
        const s = svgEl();
        if (!s) return;
        const g = s.getElementById('logo_container');
        if (!g) return;
        ['yellow','black','gray','white'].forEach(c => g.classList.remove(c));
        if (themeName) g.classList.add(themeName);
        updateLiveVars();
      }

      function copyInlineSvg() {
        const s = svgEl();
        if (!s) return;
        const serializer = new XMLSerializer();
        const source = serializer.serializeToString(s);
        navigator.clipboard.writeText(source).then(() => {
          downloadBtn.textContent = 'Copied';
          setTimeout(()=> downloadBtn.textContent = 'Copy inline SVG', 1200);
        }).catch(()=> {
          alert('Could not copy SVG. You can view source and copy manually.');
        });
      }

      // attach events
      applyBtn.addEventListener('click', () => {
        applyAll();
        restartAnimations();
      });

      restartBtn.addEventListener('click', restartAnimations);
      downloadBtn.addEventListener('click', copyInlineSvg);
      resetBtn.addEventListener('click', () => {
        resetDefaults();
        restartAnimations();
      });

      themeButtons.forEach(btn => {
        btn.addEventListener('click', () => {
          const theme = btn.getAttribute('data-theme');
          setTheme(theme);
          restartAnimations();
        });
      });

      // initial update
      updateLiveVars();

      // hydrate from computed inside svg
      (function hydrateFromComputed() {
        const s = svgEl();
        if (!s) return;
        const cs = window.getComputedStyle(s);
        const v = (k, fallback) => cs.getPropertyValue(k) ? cs.getPropertyValue(k).trim() : fallback;
        t1Duration.value = v('--text-01-duration', t1Duration.value);
        t1Start.value = v('--text-01-start', t1Start.value);
        t1Step.value = v('--text-01-step', t1Step.value);
        t1Offset.value = v('--text-01-offset-distance', t1Offset.value);

        t2Duration.value = v('--text-02-duration', t2Duration.value);
        t2Start.value = v('--text-02-start', t2Start.value);
        t2Step.value = v('--text-02-step', t2Step.value);
        t2Offset.value = v('--text-02-offset-distance', t2Offset.value);

        easingInput.value = v('--text-easing', easingInput.value);

        updateLiveVars();
      })();

      // expose API for debugging
      window._svgAnimator = { applyAll, restartAnimations, setTheme, resetDefaults };

      // -----------------------------
      // Bezier visualiser implementation
      // -----------------------------
      const canvas = document.getElementById('bezierCanvas');
      const ctx = canvas.getContext('2d');
      const c1El = document.getElementById('c1');
      const c2El = document.getElementById('c2');
      const applyVisualBtn = document.getElementById('applyVisual');

      // control points in normalized space (0..1)
      // default correspond to cubic-bezier(0,1,1,1)
      let cp1 = { x: 0.0, y: 1.0 };
      let cp2 = { x: 1.0, y: 1.0 };

      // pixel positions derived from cp*
      function cpToPx(cp) {
        // pad inside canvas so handles are visible
        const pad = 8;
        const w = canvas.width - pad * 2;
        const h = canvas.height - pad * 2;
        return {
          x: pad + cp.x * w,
          y: pad + (1 - cp.y) * h
        };
      }
      function pxToCp(px) {
        const pad = 8;
        const w = canvas.width - pad * 2;
        const h = canvas.height - pad * 2;
        let nx = (px.x - pad) / w;
        let ny = 1 - ((px.y - pad) / h);
        nx = Math.min(1, Math.max(0, nx));
        ny = Math.min(1, Math.max(0, ny));
        return { x: nx, y: ny };
      }

      // draw function
      function drawBezierPreview() {
        ctx.clearRect(0,0,canvas.width,canvas.height);

        // axes
        ctx.strokeStyle = '#e6e6e6';
        ctx.lineWidth = 1;
        ctx.beginPath();
        // baseline
        ctx.moveTo(8, canvas.height - 8);
        ctx.lineTo(canvas.width - 8, canvas.height - 8);
        ctx.stroke();

        // grid minor
        ctx.strokeStyle = '#f5f5f5';
        for (let i = 1; i < 4; i++) {
          let gx = 8 + i * (canvas.width - 16) / 4;
          ctx.beginPath();
          ctx.moveTo(gx, 8);
          ctx.lineTo(gx, canvas.height - 8);
          ctx.stroke();
        }

        // compute handle pixels
        const p0 = { x: 8, y: canvas.height - 8 };
        const p3 = { x: canvas.width - 8, y: 8 };
        const h1 = cpToPx(cp1);
        const h2 = cpToPx(cp2);

        // draw bezier curve (sample)
        ctx.lineWidth = 2;
        ctx.strokeStyle = '#0a66c2';
        ctx.beginPath();
        ctx.moveTo(p0.x, p0.y);
        const steps = 120;
        for (let t = 0; t <= 1; t += 1/steps) {
          const x = cubicBezier(t, 0, cp1.x, cp2.x, 1);
          const y = cubicBezier(t, 0, cp1.y, cp2.y, 1);
          const px = 8 + x * (canvas.width - 16);
          const py = 8 + (1 - y) * (canvas.height - 16);
          ctx.lineTo(px, py);
        }
        ctx.stroke();

        // draw control lines
        ctx.strokeStyle = '#c7d6e6';
        ctx.lineWidth = 1;
        ctx.beginPath();
        ctx.moveTo(p0.x, p0.y);
        ctx.lineTo(h1.x, h1.y);
        ctx.lineTo(h2.x, h2.y);
        ctx.lineTo(p3.x, p3.y);
        ctx.stroke();

        // draw handles
        drawHandle(h1);
        drawHandle(h2);

        // update text labels
        c1El.textContent = `${cp1.x.toFixed(3)}, ${cp1.y.toFixed(3)}`;
        c2El.textContent = `${cp2.x.toFixed(3)}, ${cp2.y.toFixed(3)}`;
      }

      function drawHandle(p) {
        ctx.fillStyle = '#fff';
        ctx.strokeStyle = '#0a66c2';
        ctx.lineWidth = 2;
        ctx.beginPath();
        ctx.arc(p.x, p.y, 6, 0, Math.PI * 2);
        ctx.fill();
        ctx.stroke();
      }

      // cubic bezier helper (coordinate)
      function cubicBezier(t, a, b, c, d) {
        // returns value at t for cubic bezier defined by points a,b,c,d
        const mt = 1 - t;
        return (mt*mt*mt*a) + (3*mt*mt*t*b) + (3*mt*t*t*c) + (t*t*t*d);
      }

      // set cp from easing string like cubic-bezier(x1, y1, x2, y2)
      function parseEasingToCP(easingStr) {
        const m = easingStr.match(/cubic-bezier\s*\(\s*([^)]+)\)/i);
        if (!m) return null;
        const parts = m[1].split(',').map(p => parseFloat(p.trim()));
        if (parts.length !== 4 || parts.some(isNaN)) return null;
        return { cp1: { x: parts[0], y: parts[1] }, cp2: { x: parts[2], y: parts[3] } };
      }

      function cpToEasingString(cp1v, cp2v) {
        return `cubic-bezier(${cp1v.x.toFixed(3)}, ${cp1v.y.toFixed(3)}, ${cp2v.x.toFixed(3)}, ${cp2v.y.toFixed(3)})`;
      }

      // initialise from input
      function hydrateVisualiserFromInput() {
        const parsed = parseEasingToCP(easingInput.value.trim());
        if (parsed) {
          cp1 = { x: parsed.cp1.x, y: parsed.cp1.y };
          cp2 = { x: parsed.cp2.x, y: parsed.cp2.y };
        } else {
          // fallback keep defaults
        }
        drawBezierPreview();
      }

      // allow dragging
      let dragging = null;
      function getMousePos(evt) {
        const rect = canvas.getBoundingClientRect();
        return { x: evt.clientX - rect.left, y: evt.clientY - rect.top };
      }

      canvas.addEventListener('mousedown', (e) => {
        const pos = getMousePos(e);
        const h1 = cpToPx(cp1);
        const h2 = cpToPx(cp2);
        if (distance(pos, h1) < 12) { dragging = 'cp1'; return; }
        if (distance(pos, h2) < 12) { dragging = 'cp2'; return; }
      });
      window.addEventListener('mousemove', (e) => {
        if (!dragging) return;
        const pos = getMousePos(e);
        const cp = pxToCp(pos);
        if (dragging === 'cp1') { cp1 = cp; }
        if (dragging === 'cp2') { cp2 = cp; }
        // update easing input live
        easingInput.value = cpToEasingString(cp1, cp2);
        // apply directly into svg var for live preview and restart animations
        setVarOnSvg('--text-easing', easingInput.value);
        restartAnimations();
        drawBezierPreview();
      });
      window.addEventListener('mouseup', () => { dragging = null; });

      // touch support
      canvas.addEventListener('touchstart', (ev) => {
        const t = ev.touches[0];
        const pos = getMousePos(t);
        const h1 = cpToPx(cp1);
        const h2 = cpToPx(cp2);
        if (distance(pos, h1) < 16) { dragging = 'cp1'; ev.preventDefault(); return; }
        if (distance(pos, h2) < 16) { dragging = 'cp2'; ev.preventDefault(); return; }
      }, {passive:false});
      window.addEventListener('touchmove', (ev) => {
        if (!dragging) return;
        const t = ev.touches[0];
        const pos = getMousePos(t);
        const cp = pxToCp(pos);
        if (dragging === 'cp1') { cp1 = cp; }
        if (dragging === 'cp2') { cp2 = cp; }
        easingInput.value = cpToEasingString(cp1, cp2);
        setVarOnSvg('--text-easing', easingInput.value);
        restartAnimations();
        drawBezierPreview();
        ev.preventDefault();
      }, {passive:false});
      window.addEventListener('touchend', () => { dragging = null; });

      function distance(p1, p2) {
        return Math.hypot(p1.x - p2.x, p1.y - p2.y);
      }

      // update when editing input directly
      easingInput.addEventListener('input', () => {
        const parsed = parseEasingToCP(easingInput.value.trim());
        if (parsed) {
          cp1 = { x: parsed.cp1.x, y: parsed.cp1.y };
          cp2 = { x: parsed.cp2.x, y: parsed.cp2.y };
          // apply easing to svg live
          setVarOnSvg('--text-easing', easingInput.value);
          restartAnimations();
        }
        drawBezierPreview();
      });

      // apply visual button to push easing to svg, restart
      applyVisualBtn.addEventListener('click', () => {
        setVarOnSvg('--text-easing', easingInput.value);
        restartAnimations();
        updateLiveVars();
      });

      // initial draw: try to parse existing easing input
      hydrateVisualiserFromInput();

      document.getElementById("runAi").addEventListener("click", async () => {
        const prompt = document.getElementById("aiPrompt").value;

        let jsonString = JSON.stringify({
          model: "llama3",
          prompt: `You are controlling animation CSS variables.  the variables are: ${styles} The user will describe visual changes. Output ONLY revised CSS variable values based on USER request. No explanations. No preamble.  Display entire css variables including ones not changed. No line breaks!. User request: ${prompt}`
        })

        const response = await fetch("http://localhost:3001/api/generate", {
          method: "POST",
          headers: { "Content-Type": "application/json" },
          body: jsonString

        });

        const result = await response.text();

        let cssValues = JSON.parse(result).output.trim();
        styles = cssValues;
        cssValues = cssValues.replace(/\`/g,"")


        const cssObject = Object.fromEntries(
          cssValues
          .trim()
          .split(/\n/) // split by line
          .map(line => line.trim().replace(/^--/, '').replace(/;$/, '')) // remove -- and ;
          .map(line => {
          const [key, value] = line.split(/:\s*/); // split by :
            return [key, value];
          })
        );

        console.log(cssObject)

        t1Duration.value = cssObject["text-01-duration"] || "";
        t1Start.value = cssObject["text-01-start"] || "";
        t1Step.value = cssObject["text-01-step"] || "";
        t1Offset.value = cssObject["text-01-offset-distance"] || "";

        t2Duration.value = cssObject["text-02-duration"] || "";
        t2Start.value = cssObject["text-02-start"] || "";
        t2Step.value = cssObject["text-02-step"] || "";
        t2Offset.value = cssObject["text-02-offset-distance"] || "";

        easingInput.value = cssObject["text-easing"] || "";


      });

    })();
  </script>
</body>
</html>
